<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Relatórios Mensais | RF Finance Empresarial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="../manifest.json">

<link rel="stylesheet" href="../theme/variables.css">
<link rel="stylesheet" href="../theme/global.css">
</head>
<body>

<!-- MENU -->
<div id="menu"></div>

<main class="container">
  <h1>Relatório Mensal</h1>

  <label>Mês</label>
  <input id="mes" type="month">

  <button onclick="gerar()">Gerar Relatório</button>

  <div id="resultado" style="display:none; margin-top:20px;">
    <h2>Resumo do Mês</h2>

    <p>Total de vendas: <strong id="totalVendas"></strong></p>
    <p>Receita: R$ <strong id="receita"></strong></p>
    <p>Custo dos produtos: R$ <strong id="custos"></strong></p>
    <p>Impostos: R$ <strong id="impostos"></strong></p>
    <p>Lucro / Prejuízo: R$ <strong id="lucro"></strong></p>

    <div id="statusBox" class="resultado"></div>
  </div>
</main>

<!-- CORE SCRIPTS -->
<script src="../core/datamanager.js"></script>
<script src="../core/relatorios.engine.js"></script>

<!-- MENU LOAD -->
<script>
fetch("menu.html")
  .then(r => r.text())
  .then(html => document.getElementById("menu").innerHTML = html);
</script>

<!-- RELATÓRIO LOGIC -->
<script>
function gerar() {
  const mesEl = document.getElementById("mes");

  if (!mesEl.value) {
    alert("Selecione um mês");
    return;
  }

  const [ano, m] = mesEl.value.split("-");
  const r = RelatoriosEngine.mensal(Number(ano), Number(m) - 1);

  document.getElementById("totalVendas").innerText = r.totalVendas;
  document.getElementById("receita").innerText = r.receita.toFixed(2);
  document.getElementById("custos").innerText = r.custoProdutos.toFixed(2);
  document.getElementById("impostos").innerText = r.impostos.toFixed(2);
  document.getElementById("lucro").innerText = r.lucro.toFixed(2);

  const box = document.getElementById("statusBox");
  box.innerText =
    r.status === "lucro" ? "Lucro" :
    r.status === "prejuizo" ? "Prejuízo" :
    "Empate";

  box.className = "resultado " + r.status;
  document.getElementById("resultado").style.display = "block";
}
</script>

<!-- SERVICE WORKER -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("../service-worker.js");
}
</script>

</body>
</html>