<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Produtos | RF Finance Empresarial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../theme/variables.css">
<link rel="stylesheet" href="../theme/global.css">
</head>
<body>

<main class="container">
  <h1>Cadastro de Produtos</h1>
  <p>Informe os custos e o tempo de trabalho por produto.</p>

  <label>Nome do Produto</label>
  <input id="nome" type="text" placeholder="Ex: Camisa Polo">

  <label>Custo de Compra / Produção (R$)</label>
  <input id="custoBase" type="number" step="0.01">

  <label>Frete Unitário (R$)</label>
  <input id="frete" type="number" step="0.01">

  <label>Perdas / Quebras (R$)</label>
  <input id="perdas" type="number" step="0.01">

  <label>Embalagem (R$)</label>
  <input id="embalagem" type="number" step="0.01">

  <hr>

  <h2>Mão de Obra no Produto</h2>
  <p>Informe quanto tempo cada funcionário trabalha nesse produto.</p>

  <div id="maoDeObra"></div>

  <button onclick="salvar()">Salvar Produto</button>

  <hr>

  <h2>Produtos Cadastrados</h2>
  <ul id="lista"></ul>
</main>

<script src="../core/datamanager.js"></script>
<script src="../core/maoobra.engine.js"></script>
<script src="../core/custos.engine.js"></script>

<script>
function carregarFuncionarios() {
  const container = document.getElementById("maoDeObra");
  const funcionarios = DataManager.get("funcionarios") || [];

  funcionarios.forEach((f, i) => {
    const div = document.createElement("div");
    div.innerHTML = `
      <label>${f.nome} (minutos por produto)</label>
      <input type="number" id="tempo_${i}" placeholder="Ex: 15">
    `;
    container.appendChild(div);
  });
}

function salvar() {
  if (!nome.value || !custoBase.value) {
    alert("Preencha ao menos o nome e o custo base");
    return;
  }

  const funcionarios = DataManager.get("funcionarios") || [];
  let maoDeObraTotal = 0;

  funcionarios.forEach((f, i) => {
    const minutos = Number(document.getElementById(`tempo_${i}`).value || 0);
    const horas = minutos / 60;
    maoDeObraTotal += MaoDeObraEngine.custoHora(f) * horas;
  });

  DataManager.push("produtos", {
    nome: nome.value,
    custoBase: Number(custoBase.value),
    frete: Number(frete.value || 0),
    perdas: Number(perdas.value || 0),
    embalagem: Number(embalagem.value || 0),
    maoDeObra: maoDeObraTotal
  });

  limpar();
  render();
}

function limpar() {
  nome.value = "";
  custoBase.value = "";
  frete.value = "";
  perdas.value = "";
  embalagem.value = "";
}

function render() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  const produtos = DataManager.get("produtos") || [];

  produtos.forEach((p, i) => {
    const custo = CustosEngine.custoReal(p).toFixed(2);

    const li = document.createElement("li");
    li.innerHTML = `
      <div>
        <strong>${p.nome}</strong><br>
        Custo real unitário: R$ ${custo}
      </div>
      <button onclick="remover(${i})">X</button>
    `;
    lista.appendChild(li);
  });
}

function remover(index) {
  const produtos = DataManager.get("produtos");
  produtos.splice(index, 1);
  DataManager.set("produtos", produtos);
  render();
}

carregarFuncionarios();
render();
</script>

</body>
</html>