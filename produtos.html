<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Produtos | RF Finance Empresarial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../theme/variables.css">
<link rel="stylesheet" href="../theme/global.css">
</head>
<body>

<main class="container">
  <h1>Cadastro de Produtos</h1>
  <p>Informe os custos unitários do produto.</p>

  <label>Nome do Produto</label>
  <input id="nome" type="text" placeholder="Ex: Camisa Polo">

  <label>Custo de Compra (R$)</label>
  <input id="compra" type="number" step="0.01">

  <label>Frete Unitário (R$)</label>
  <input id="frete" type="number" step="0.01">

  <label>Impostos na Compra (R$)</label>
  <input id="impostos" type="number" step="0.01">

  <label>Perdas / Quebras (R$)</label>
  <input id="perdas" type="number" step="0.01">

  <button onclick="salvar()">Salvar Produto</button>

  <hr>

  <h2>Produtos Cadastrados</h2>
  <ul id="lista"></ul>
</main>

<script src="../core/storage.js"></script>
<script src="../core/datamanager.js"></script>
<script src="../core/financeiro.js"></script>

<script>
function salvar() {
  if (!nome.value || !compra.value) {
    alert("Informe ao menos nome e custo de compra");
    return;
  }

  DataManager.push("produtos", {
    nome: nome.value,
    custoCompra: Number(compra.value),
    frete: Number(frete.value || 0),
    impostosCompra: Number(impostos.value || 0),
    perdas: Number(perdas.value || 0)
  });

  limpar();
  render();
}

function limpar() {
  nome.value = "";
  compra.value = "";
  frete.value = "";
  impostos.value = "";
  perdas.value = "";
}

function render() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  const produtos = DataManager.get("produtos") || [];

  produtos.forEach((p, i) => {
    const custo = Financeiro.custoTotalProduto(p).toFixed(2);

    const li = document.createElement("li");
    li.innerHTML = `
      <div>
        <strong>${p.nome}</strong><br>
        Custo unitário: R$ ${custo}
      </div>
      <button onclick="remover(${i})">X</button>
    `;
    lista.appendChild(li);
  });
}

function remover(index) {
  const produtos = DataManager.get("produtos");
  produtos.splice(index, 1);
  DataManager.set("produtos", produtos);
  render();
}

render();
</script>

</body>
</html>